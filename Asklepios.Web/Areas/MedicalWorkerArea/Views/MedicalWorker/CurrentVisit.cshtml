@using Asklepios.Core.MockModels
@model Asklepios.Web.Areas.MedicalWorkerArea.Models.CurrentVisitViewModel
@{
    SelectList availableServicesForReferrals = new SelectList(Model.MedicalServicesForReferrals, "Id", "Name");
    //Asklepios.Web.Areas.MedicalWorkerArea.Models.SubmitMode mode;
}
<partial name="_MessageTemp" model="TempData" />

<div class="d-flex jumbotron flex-column" style=" padding:20px;display:flex;align-content:center;position:relative">

    <div class="d-flex mb-3 flex-wrap align-self-top align-items-top">

        <div class="p-2 align-content-center align-items-center align-self-top  mx-auto " style="min-width: 400px; text-align: center">
            <div class="d-flex flex-fill flex-column justify-content-center" style="text-align:center">
                <h3 style="font-weight:900;">
                    <a asp-action="MedicalWorkerDetails" asp-controller="MedicalWorker" asp-route-id="@Model.Visit.MedicalWorkerId">
                        @Model.Visit.MedicalWorker.FullProffesionalName
                    </a>
                </h3>
                <div class="d-flex align-content-center mr-auto pt-2" style="text-align:center;height:200px">
                    <img alt="@Model.Visit.MedicalWorker.FullProffesionalName" src="@Model.Visit.MedicalWorker.Person.ImageSource" class="mx-auto d-block" style="max-width: 400px;  display: block; border-radius: 6px;object-fit: contain ">
                </div>
            </div>
        </div>
        <div class="p-2   align-content-center align-items-center align-self-top mx-auto " style="min-width:400px;  text-align:center">
            <div class="d-flex flex-fill flex-column justify-content-center" style="text-align:center">
                @if (Model.Visit.VisitStatus == Asklepios.Core.Enums.VisitStatus.Booked)
                {
                    <h3 style="font-weight:900;">
                        <a asp-action="PatientDetails" asp-controller="MedicalWorker" asp-route-id="@Model.Visit.Patient.Id">
                            @Model.Visit.Patient.Person.FullName
                        </a>
                    </h3>
                    <div class="d-flex flex-fill  justify-content-center mt-2" style="text-align:center;height:200px">
                        <img alt="@Model.Visit.Patient.Person.FullName" src="@Model.Visit.Patient.Person.ImageSource" class="mx-auto d-block" style="max-width:400px; display: block; border-radius: 6px; object-fit: contain">
                    </div>
                }
                else
                {
                    <h3 style="font-weight:900;">
                        Wizyta nie została jeszcze zarezerwowana
                    </h3>
                }
            </div>
        </div>
    </div>
    <div class="d-flex flex-column mx-2">
        <h5> Czas i miejsce</h5>
        <div class="border border-secondary rounded w-100 flex-grow-0 mb-3  p-3">
            <div class="flex-column  mx-auto flex-grow-1">
                <div>
                    Data: @Model.Visit.GetVisitDateFullDescription()
                </div>
                <div>
                    @Model.Visit.Location.Name
                </div>
                <div>
                    Piętro: @Model.Visit.MedicalRoom.FloorNumber, pokój: @Model.Visit.MedicalRoom.Name
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex flex-column mx-2">
        <h5>Usługa</h5>
        <div class="border border-secondary rounded w-100 flex-grow-0 mb-3  p-3">
            @*<div class="d-flex" style="margin:0px; width:200px">
                Kategoria: @Model.Visit.VisitCategory.CategoryName
                </div>*@
            <div class="d-flex flex-row align-content-around">
                <div class="d-flex" style="margin:0px; min-width:250px">Kategoria : </div>
                <div class="d-flex" style="margin:0px; text-align:right;width: 250px">
                    <span class="ml-auto">@Model.Visit.VisitCategory.CategoryName</span>
                </div>
                <div class="d-flex ml-5" style="margin:0px; text-align:right;width:40px;">
                    @*<button class="fa-plus hidden"/>*@
                    @*<span style="width:400px;">@Model.Visit.GetPrice(Model.Visit.PrimaryService) PLN</span>*@
                </div>
            </div>

            @*<br />*@
            @*<p>Koszty</p>*@
            <div class="font-weight-bold my-1 " style="width: 200px">Usługa główna</div>
            <div class="d-flex flex-row">
                <div class="d-flex" style="margin:0px; width:250px;    overflow-wrap: break-word;">@Model.Visit.PrimaryService.Name : </div>
                <div class="d-flex" style="margin: 0px; text-align: right; width: 250px">
                    <span class="ml-auto">@Model.Visit.GetPrice(Model.Visit.PrimaryService).ToString("c") PLN</span>
                </div>
                <div class="d-flex ml-5" style="margin:0px; text-align:right;width:40px">
                    @*<button class="fa-plus hidden"/>*@
                    @*<span style="width:400px;">@Model.Visit.GetPrice(Model.Visit.PrimaryService) PLN</span>*@
                </div>
            </div>
            @if (Model.Visit.MinorMedicalServices?.Count > 0)
            {
                <div class="font-weight-bold my-1">Usługi dodatkowe</div>
            }
            @for (int i = 0; i < Model.VisitSummary.MinorMedicalServices?.Count; i++)
            {
                ServiceMock service = Model.VisitSummary.MinorMedicalServices[i];
                if (service != null)
                {
                    <div class="d-flex flex-row flex-wrap mt-1">
                        <div style="width:250px;    overflow-wrap: break-word;">
                            @service.Name : @*@Model.Visit.GetPrice(service); PLN*@
                        </div>
                        <div class="d-flex" style=" text-align:right;">
                            <div style="width:250px; align-self:center">@Model.Visit.GetPrice(service).ToString("c") PLN</div>
                        </div>

                        <form class="form ml-5 " style="width:40px" asp-action="RemoveService" method="post">
                            <input asp-for="VisitId" hidden />
                            <input asp-for="ServiceToRemoveIndex" value="@i" hidden />
                            <button type="submit" class="btn btn-primary btn-icon-split    form-control " data-toggle="tooltip" data-placement="top" title="Usuń usługę">
                                <span class="icon text-white left" style="text-align:left;float:left">
                                    <i class="fas fa-minus"></i>
                                </span>
                            </button>
                        </form>
                    </div>
                }
            }
            <div class="d-flex flex-row">
                <span class="d-flex" style="margin:0px; width:250px"> </span>
                <div style="width:250px" class="align-items-end">
                    <hr class="ml-auto float-right" style="height:2px;width:100px;  border-width:0;color:gray;background-color:gray; ">
                </div>
                <div class="d-flex ml-5" style="margin:0px; text-align:right;width:40px">
                </div>
            </div>
            <div class="d-flex flex-row mb-3">
                <span class="d-flex font-weight-bold" style="margin:0px; width:250px">Koszt całkowity: </span>
                @*<span class="d-flex">@Model.Visit.GetTotalPrice() PLN</span>*@
                <div class="d-flex" style="margin:0px; text-align:right;">
                    <span style="width:250px;">@Model.Visit.GetTotalPrice(@Model.VisitSummary.MinorMedicalServices).ToString("c") PLN</span>
                </div>
                <div class="d-flex ml-5" style="margin:0px; text-align:right;width:40px">
                </div>
                @*<div class="ml-5"></div>*@
            </div>
            @*<br class="m-0"/>*@
            @if (Model.AvailableMinorServices?.Count > 0)
            {
                <hr class="mx-0 my-1" style="height:2px; border-width:0;color:gray;background-color:gray;text-align:right; ">

                <div class="d-flex flex-column mt-3">
                    <div class="font-weight-bold">
                        Dostępne dodatkowe usługi
                    </div>

                    @for (int i = 0; i < Model.AvailableMinorServices.Count; i++)
                    {
                        MedicalService service = Model.AvailableMinorServices[i];
                        <div class="d-flex flex-row mt-1 align-content-around flex-wrap mt-1">
                            <div class="align-self-center" style="width:250px;    overflow-wrap: break-word;">
                                @service.Name : @*@Model.Visit.GetPrice(service); PLN*@
                            </div>
                            <div class="d-flex" style=" text-align:right;">
                                <div style="width:250px; align-self:center">@Model.Visit.GetPrice(service).ToString("c") PLN</div>
                            </div>

                            <div class="d-flex flex-column ml-5 align-self: center">
                                <form class="form" asp-action="AddService" method="post">
                                    <input asp-for="VisitId" hidden />
                                    <input asp-for="ServiceToAddId" value="@service.Id" hidden />
                                    <button type="submit" class="btn btn-primary btn-icon-split   form-control" data-toggle="tooltip" data-placement="top" title="Tooltip on top">
                                        <span class="icon text-white left" style="text-align:left;float:left">
                                            <i class="fas fa-plus"></i>
                                        </span>
                                        @*<div class="tooltip">
                                            <span class="text tooltip-inner" style="float: left">Dodaj usługę</span>
                                            </div>*@

                                    </button>
                                </form>

                            </div>
                        </div>
                    }
                </div>
            }
        </div>
    </div>
    @if (Model.Visit.UsedExaminationReferral != null)
    {
        <div class="d-flex flex-column mx-2 mt-2">
            <h5>Użyte skierowanie</h5>

            <partial name="_MedicalReferral" model="Model.Visit.UsedExaminationReferral" />


        </div>

    }
    <div class="d-flex flex-column mx-2 mt-2">
        <h5>Wywiad medyczny</h5>
        <div class="border border-secondary rounded w-100 flex-grow-0 mb-3  p-3">
            @*<label asp-for="Visit.MedicalHistory" class="control-label"></label>*@
            <form class="form" asp-action="AddMedicalHistory" method="post">
                <textarea asp-for="VisitSummary.MedicalHistory" class="form-control mb-2" TextMode="MultiLine" Rows="5"></textarea>
                <span asp-validation-for="VisitSummary.MedicalHistory" class="text-danger"></span>

                @*<input asp-for="Visit.MedicalHistory" value="@Model.Visit.MedicalHistory" hidden />*@
                <input asp-for="Visit.Id" value="@Model.Visit.Id" hidden />
                <button type="submit" class="btn btn-primary btn-icon-split mt-3  form-control" data-toggle="tooltip" data-placement="top" title="Zapisz wywiad medyczny">
                    <span class="icon text-white left" style="text-align:left;float:left">
                        <i class="fas fa-save"></i>
                    </span>
                    <span class="text" style="float: left">Zachowaj</span>
                </button>
            </form>
        </div>
    </div>
    <div class="d-flex flex-column mx-2 mt-2">
        <h5>Zalecenia</h5>
        <div class="border border-secondary rounded w-100 flex-grow-0 mb-3  p-3">
            @if (Model.VisitSummary.Recommendations?.Count > 0)
            {
                for (int i = 0; i < Model.VisitSummary.Recommendations.Count; i++)
                {
                    RecommendationMock recommendation = Model.VisitSummary.Recommendations[i];
                    <form class="form mb-3" asp-action="RemoveRecommendation" method="post">
                        <div class="d-flex flex-column">
                            <input type="text" value="@recommendation.Title" class="form-control mb-2 readonly" readonly />
                            <textarea class="form-control mb-2" TextMode="MultiLine" readonly>@recommendation.Description</textarea>
                            <input asp-for="RecommendationToRemoveIndex" value="@i" hidden />

                            <button type="submit" class="btn btn-primary btn-icon-split    form-control" data-toggle="tooltip" data-placement="top" title="Usuń wywiad medyczny">
                                <span class="icon text-white left" style="text-align:left;float:left">
                                    <i class="fas fa-minus"></i>
                                </span>
                                <span class="text" style="float: left">Usuń</span>
                            </button>
                        </div>

                    </form>
                    <hr class="mr-0 my-1" style="height:2px;width:100%; border-width:0;color:gray;background-color:gray;">
                }
            }
            <form class="form" asp-action="AddRecommendation" method="post">
                <div class="d-flex flex-column">
                    <label asp-for="VisitSummary.RecommendationToAdd.Title"></label>
                    <input type="text" asp-for="VisitSummary.RecommendationToAdd.Title" class="form-control mb-2" />
                    <label asp-validation-for="VisitSummary.RecommendationToAdd.Title"></label>

                    <label asp-for="VisitSummary.RecommendationToAdd.Description"></label>
                    <textarea asp-for="VisitSummary.RecommendationToAdd.Description" class="form-control mb-2" TextMode="MultiLine" Rows="5"></textarea>
                    <span asp-validation-for="VisitSummary.RecommendationToAdd.Description" class="text-danger"></span>
                    <button type="submit" class="btn btn-primary btn-icon-split  mt-3  form-control" data-toggle="tooltip" data-placement="top" title="Zapisz zalecenie">
                        <span class="icon text-white left" style="text-align:left;float:left">
                            <i class="fas fa-save"></i>
                        </span>
                        <span class="text" style="float: left">Zachowaj</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
    @if (Model.Visit.MedicalWorker.CanIssueExamReferral)
    {
        <div class="d-flex flex-column mx-2 mt-2">
            <h5>Skierowania</h5>

            <div class="border border-secondary rounded w-100 flex-grow-0 mb-3  p-3">

                @if (Model.VisitSummary.ReferralMocks != null && Model.VisitSummary.ReferralMocks.Count > 0)
                {
                    <div class="d-flex flex-column mx-2">
                        <h5>Wystawione skierowania</h5>
                        @for (int i = 0; i < Model.VisitSummary.ReferralMocks.Count; i++)
                        {
                            ReferralMock referral = Model.VisitSummary.ReferralMocks[i];
                            @*<hr class="mr-0 my-1" style="height:2px;width:100%; border-width:0;color:gray;background-color:gray;">*@

                            <div>
                                Usługa: @referral.PrimaryMedicalServiceName
                            </div>
                            @if (referral.MinorMedicalServiceName != null)
                            {
                                <span>
                                    Podusługa: @referral.MinorMedicalServiceName
                                </span>
                            }
                            @*                            <div>
                                Wystawione: @referral.IssueDate.ToString("dd-MM-yyyy")
                                </div>
                                <div>
                                Ważne do: @referral.ExpireDate.ToString("dd-MM-yyyy")
                                </div>
                                if (referral.HasBeenUsed)
                                {
                                <p>
                                Skierowanie zostało wykorzystane
                                </p>
                                }
                                else if (referral.HasExpired)
                                {
                                <p>Ważność skierowania upłynęła</p>
                                }

                            *@
                            <div>
                                Komentarz: @referral.Comment
                            </div>

                            <form class="form my-2" asp-action="RemoveExaminationReferral" method="post" asp-validation-summary="ModelOnly">
                                @*asp-action="RemoveExaminationReferral"*@
                                <div class="d-flex flex-column">
                                    <input asp-for="Visit.Id" value="@Model.Visit.Id" hidden />
                                    <input asp-for="ReferralToRemoveIndex" value="@i" hidden />
                                    <button type="submit" class="btn btn-primary btn-icon-split  mt-3  form-control" data-toggle="tooltip" data-placement="top" title="Tooltip on top">
                                        <span class="icon text-white left" style="text-align:left;float:left">
                                            <i class="fas fa-trash"></i>
                                        </span>
                                        <span class="text" style="float: left">Usuń skierowanie</span>
                                    </button>
                                </div>
                            </form>
                            <hr class="mr-0 my-1" style="height:2px;width:100%; border-width:0;color:gray;background-color:gray;">
                        }
                    </div>
                }
                <form class="form my-2" asp-action="AddExaminationReferral" method="post" asp-validation-summary="ModelOnly">
                    @{
                        Model.SubmitMode = Asklepios.Web.Areas.MedicalWorkerArea.Models.SubmitMode.AddReferral;
                    }
                    @*<form class="form" asp-action="AddExaminationReferral" method="post">*@
                    <div class="d-flex flex-column">
                        <input asp-for="Visit.Id" value="@Model.Visit.Id" hidden />
                        <input asp-for="SubmitMode" value="@Model.SubmitMode" hidden />
                        @*<div class="form-group">*@

                        <label asp-for="VisitSummary.ReferralMockToAdd.PrimaryMedicalServiceId" class="control-label"></label>
                        <select class="form-control  mb-2" asp-for="VisitSummary.ReferralMockToAdd.PrimaryMedicalServiceId" asp-items="availableServicesForReferrals">
                            <option value="-1">Wybierz usługę</option>
                        </select>
                        <span asp-validation-for="VisitSummary.ReferralMockToAdd.PrimaryMedicalServiceId" class="text-danger"></span>

                        <label asp-for="VisitSummary.ReferralMockToAdd.ServiceReferralDaysToExpire" class="control-label"></label>
                        <input type="number" class="form-control  mb-2" asp-for="VisitSummary.ReferralMockToAdd.ServiceReferralDaysToExpire" value="14" />
                        <span asp-validation-for="VisitSummary.ReferralMockToAdd.ServiceReferralDaysToExpire" class="text-danger"></span>

                        <label asp-for="VisitSummary.ReferralMockToAdd.Comment" class="control-label"></label>
                        <input type="text" class="form-control  mb-2" asp-for="VisitSummary.ReferralMockToAdd.Comment" />
                        <span asp-validation-for="VisitSummary.ReferralMockToAdd.Comment" class="text-danger"></span>

                        <button type="submit" class="btn btn-primary btn-icon-split mt-3   form-control" data-toggle="tooltip" data-placement="top" title="Tooltip on top">
                            <span class="icon text-white left" style="text-align:left;float:left">
                                <i class="fas fa-server"></i>
                            </span>
                            <span class="text" style="float: left">Wystaw skierowanie</span>
                        </button>
                    </div>
                </form>
            </div>


        </div>

    }
    @if (Model.Visit.MedicalWorker.CanIssuePrescription)
    {
        <div class="d-flex flex-column mx-2">
            <h5>Recepta</h5>

            <div class="border border-secondary rounded w-100 flex-grow-0 mb-3  p-3">
                @if (Model.VisitSummary.PrescriptionToAdd != null)
                {

                    <div class="d-flex flex-fill pt-2 flex-column">

                        <div>
                            Wystawione: @Model.VisitSummary.PrescriptionToAdd.IssueDate.ToString("dd-MM-yyyy")
                        </div>
                        <div>
                            Ważne do: @Model.VisitSummary.PrescriptionToAdd.ExpirationDate.ToString("dd-MM-yyyy")
                        </div>
                        <div>
                            Numer identyfikacyjny recepty:
                            <span style="font-weight:bold"> @Model.VisitSummary.PrescriptionToAdd.IdentificationCode</span>
                        </div>
                        <p>Kod dostępu: <span style="font-weight:bold">  @Model.VisitSummary.PrescriptionToAdd.AccessCode</span> </p>
                    </div>
                    <hr class="mr-0 mb-2 mt-0" style="height:2px;width:100%; border-width:0;color:gray;background-color:gray;">

                    <div class="d-flex flex-fill  flex-column">
                        @*<p>*@
                        @{

                            for (int i = 0; i < Model.VisitSummary.Medicines.Count; i++)
                            {
                                MedicineMock item = Model.VisitSummary.Medicines[i];
                                <partial name="_MedicineMock" model="item" />
                                <form class="form my-2" asp-action="RemoveMedicineFromPrescription" method="post" asp-validation-summary="ModelOnly">
                                    <div class="d-flex flex-column">
                                        <input asp-for="Visit.Id" value="Visit.Id" hidden />
                                        <input asp-for="MedicineIndexToRemove" value="@i" hidden />

                                        <button type="submit" class="btn btn-primary btn-icon-split  mt-3  form-control" data-toggle="tooltip" data-placement="top" title="Tooltip on top">
                                            <span class="icon text-white left" style="text-align:left;float:left">
                                                <i class="fas fa-minus"></i>
                                            </span>
                                            <span class="text" style="float: left">Usuń lek</span>
                                        </button>

                                    </div>
                                </form>
                                <hr class="mr-0 my-1" style="height:2px;width:100%; border-width:0;color:gray;background-color:gray;">

                                if (i == Model.VisitSummary.Medicines.Count - 1)
                                {

                                }
                                else
                                {
                                    <br />
                                }
                            }
                        }
                        @*</p>*@
                    </div>
                    <form class="form my-2" asp-action="AddMedicineToPrescription" method="post" asp-validation-summary="ModelOnly">
                        @{
                            Model.SubmitMode = Asklepios.Web.Areas.MedicalWorkerArea.Models.SubmitMode.AddMedicineToPrescription;
                        }
                        <div class="d-flex flex-column">
                            <input asp-for="Visit.Id" value="@Model.Visit.Id" hidden />
                            <input asp-for="SubmitMode" value="@Model.SubmitMode" hidden />

                            @*<div class="form-group">*@
                            <label asp-for="VisitSummary.MedicineToAdd.MedicineName" class="control-label"></label>
                            <input type="text" class="form-control  mb-2" asp-for="VisitSummary.MedicineToAdd.MedicineName" />
                            <span asp-validation-for="VisitSummary.MedicineToAdd.MedicineName" class="text-danger"></span>
                            @*</div>*@
                            @*<div class="form-group">*@
                            <label asp-for="VisitSummary.MedicineToAdd.PackageSize" class="control-label"></label>
                            <input type="text" class="form-control  mb-2" asp-for="VisitSummary.MedicineToAdd.PackageSize" />
                            <span asp-validation-for="VisitSummary.MedicineToAdd.PackageSize" class="text-danger"></span>
                            @*</div>*@
                            @*<div class="form-group">*@
                            <label asp-for="VisitSummary.MedicineToAdd.PaymentDiscount" class="control-label"></label>
                            <input type="text" class="form-control  mb-2" asp-for="VisitSummary.MedicineToAdd.PaymentDiscount" />
                            <span asp-validation-for="VisitSummary.MedicineToAdd.PaymentDiscount" class="text-danger"></span>
                            @*</div>*@
                            <button type="submit" class="btn btn-primary btn-icon-split mt-3   form-control" data-toggle="tooltip" data-placement="top" title="Tooltip on top">
                                <span class="icon text-white left" style="text-align:left;float:left">
                                    <i class="fas fa-plus"></i>
                                </span>
                                <span class="text" style="float: left">Dodaj lek</span>
                            </button>

                        </div>
                    </form>
                    <hr class="mr-0 my-1" style="height:2px;width:100%; border-width:0;color:gray;background-color:gray;">
                    <form class="form mt-3" asp-action="RemovePrescription" method="post" asp-validation-summary="ModelOnly">
                        @{
                            Model.SubmitMode = Asklepios.Web.Areas.MedicalWorkerArea.Models.SubmitMode.AddMedicineToPrescription;
                        }
                        <div class="d-flex flex-column">
                            <input asp-for="Visit.Id" value="@Model.Visit.Id" hidden />
                            @*<input asp-for="PrescriptionIdToRemove" value="@Model.PrescriptionIdToRemove" hidden />*@

                            <button type="submit" class="btn btn-primary btn-icon-split mt-3   form-control" data-toggle="tooltip" data-placement="top" title="Tooltip on top">
                                <span class="icon text-white left" style="text-align:left;float:left">
                                    <i class="fas fa-plus"></i>
                                </span>
                                <span class="text" style="float: left">Usuń receptę</span>
                            </button>

                        </div>
                    </form>

                }
                else
                {
                    <form class="form my-2" asp-action="AddPrescription" method="post" asp-validation-summary="ModelOnly">
                        @{
                            Model.SubmitMode = Asklepios.Web.Areas.MedicalWorkerArea.Models.SubmitMode.AddPrescription;
                        }
                        <div class="d-flex flex-column">
                            <input asp-for="Visit.Id" value="@Model.Visit.Id" hidden />
                            <input asp-for="SubmitMode" value="@Model.SubmitMode" hidden />
                            @*<div class="form-group">*@
                            <label asp-for="VisitSummary.PrescriptionToAdd.AccessCode" class="control-label"></label>
                            <input type="tel" class="form-control  mb-2" asp-for="VisitSummary.PrescriptionToAdd.AccessCode" />
                            <span asp-validation-for="VisitSummary.PrescriptionToAdd.AccessCode" class="text-danger"></span>
                            @*</div>
                                <div class="form-group">*@
                            <label asp-for="VisitSummary.PrescriptionToAdd.IdentificationCode" class="control-label"></label>
                            <input type="text" class="form-control  mb-2" asp-for="VisitSummary.PrescriptionToAdd.IdentificationCode" />
                            <span asp-validation-for="VisitSummary.PrescriptionToAdd.IdentificationCode" class="text-danger"></span>
                            @*</div>
                                <div class="form-group">*@
                            <label asp-for="VisitSummary.PrescriptionToAdd.DaysToExpire" class="control-label"></label>
                            <input type="number" class="form-control  mb-2" asp-for="VisitSummary.PrescriptionToAdd.DaysToExpire" value="30" />
                            <span asp-validation-for="VisitSummary.PrescriptionToAdd.DaysToExpire" class="text-danger"></span>
                            @*</div>

                                <div class="form-group">*@
                            <label asp-for="VisitSummary.MedicineToAdd.MedicineName" class="control-label"></label>
                            <input type="text" class="form-control  mb-2" asp-for="VisitSummary.MedicineToAdd.MedicineName" />
                            <span asp-validation-for="VisitSummary.MedicineToAdd.MedicineName" class="text-danger"></span>
                            @*</div>
                                <div class="form-group">*@
                            <label asp-for="VisitSummary.MedicineToAdd.PackageSize" class="control-label"></label>
                            <input type="text" class="form-control  mb-2" asp-for="VisitSummary.MedicineToAdd.PackageSize" />
                            <span asp-validation-for="VisitSummary.MedicineToAdd.PackageSize" class="text-danger"></span>
                            @*</div>
                                <div class="form-group">*@
                            <label asp-for="VisitSummary.MedicineToAdd.PaymentDiscount" class="control-label"></label>
                            <input type="number" inputmode="numeric" class="form-control  mb-2" asp-for="VisitSummary.MedicineToAdd.PaymentDiscount" />
                            <span asp-validation-for="VisitSummary.MedicineToAdd.PaymentDiscount" class="text-danger"></span>
                            @*</div>*@

                            <button type="submit" class="btn btn-primary btn-icon-split mt-3    form-control" data-toggle="tooltip" data-placement="top" title="Tooltip on top">
                                <span class="icon text-white left" style="text-align:left;float:left">
                                    <i class="fas fa-server"></i>
                                </span>
                                <span class="text" style="float: left">Wystaw receptę</span>
                            </button>
                        </div>
                    </form>
                }
            </div>
        </div>
    }
    @if (Model.Visit.MedicalWorker.CanAddMedicalTestResults)
    {
        <div class="d-flex flex-column mx-2">
            <h5>Wyniki badań</h5>
            @{
                List<MedicalService> services = null;
                if (Model.Visit.MinorMedicalServices.Count > 0)
                {
                    services = Model.Visit.MinorMedicalServices.Union(new List<MedicalService>() { Model.Visit.PrimaryService }).ToList();
                }
                else
                {
                    services = new List<MedicalService>() { Model.Visit.PrimaryService };
                }
                SelectList availableServicesForTest = new SelectList(services, "Id", "Name");
            }
            <div class="border border-secondary rounded w-100 flex-grow-0 mb-3  p-3">
                @if (Model.VisitSummary.TestResult != null)
                {
                    <div class="d-flex  m-auto flex-grow-1">
                        <div class="d-flex flex-fill pt-2 flex-column">
                            <h2>
                                Badanie: @Model.VisitSummary.TestResult.MedicalServiceName
                            </h2>

                            <div>
                                Wykonane: @Model.VisitSummary.TestResult.ExamDate.ToString("dd-MM-yyyy")
                            </div>
                            @*<a class="btn btn-primary btn-icon-split mt-3 form-control" asp-area="MedicalWorkerArea" asp-controller="MedicalWorker" asp-action="DownloadFile" asp-route-id="@Model.Visit.MedicalResult.Id">
                                <span class="icon text-white">
                                <i class="fas fa-download"></i>
                                </span>
                                <span class="text">Wyniki</span>
                                </a>*@
                        </div>
                    </div>
                    <form class="form" method="post" asp-area="MedicalWorkerArea" asp-controller="MedicalWorker" asp-action="DownloadTempResults">
                        <button type="submit" class="btn btn-primary btn-icon-split form-control w-100 mt-3">
                            <span class="icon text-white left" style="text-align:left;float:left">
                                <i class="fas fa-file-download"></i>
                            </span>
                            <span class="text" style="float: left">Wyniki</span>
                        </button>
                    </form>
                    <form class="form" method="post" asp-area="MedicalWorkerArea" asp-controller="MedicalWorker" asp-action="RemoveTestResult" asp-route-id="@Model.VisitSummary.TestResult.FilePath">
                        <input type="text" class="form-control  mb-2"  hidden />


                        <button type="submit" class="btn btn-primary btn-icon-split form-control w-100 mt-3">
                            <span class="icon text-white left" style="text-align:left;float:left">
                                <i class="fas fa-trash"></i>
                            </span>
                            <span class="text" style="float: left">Usuń wyniki</span>
                        </button>
                    </form>
                }
                else
                {
                    <form class="form" asp-action="AddTestResult" method="post" enctype="multipart/form-data">
                        @{
                            Model.SubmitMode = Asklepios.Web.Areas.MedicalWorkerArea.Models.SubmitMode.AddTestRestult;
                        }
                        <input asp-for="Visit.Id" hidden />
                        <input asp-for="SubmitMode" value="@Model.SubmitMode" hidden />

                        <label asp-for="VisitSummary.TestResult.MedicalServiceId" class="control-label"></label>
                        <select class="form-control  mb-2" asp-for="VisitSummary.TestResult.MedicalServiceId" asp-items="availableServicesForTest">
                            <option value="-1">Wybierz usługę</option>
                        </select>
                        <span asp-validation-for="MedicalTestServiceId" class="text-danger"></span>
                        <div class="d-flex flex-column">
                            <label asp-for="VisitSummary.TestResult.Description" class="control-label"></label>
                            <input type="text" class="form-control  mb-2" asp-for="VisitSummary.TestResult.Description" />
                            <span asp-validation-for="VisitSummary.TestResult.Description" class="text-danger"></span>
                        </div>
                        <div class="d-flex flex-column">
                            <label asp-for="MedicalTestFile" class="control-label"></label>
                            <input asp-for="MedicalTestFile" accept="image/*" class="form-control-file btn btn-secondary" style="text-align:center" />
                            <span asp-validation-for="MedicalTestFile" class="text-danger"></span>
                            <div class="d-flex flex-column mt-3 mb-0 pb-0">
                                <button id="btnSubmit" type="submit" class="btn btn-primary btn-icon-split d-flex mt-3">
                                    <span class="icon text-white left" style="text-align:left;float:left">
                                        <i class="fas fa-plus-square"></i>
                                    </span>
                                    <span class="text" style="float: left">Dodaj</span>
                                </button>
                            </div>
                        </div>
                    </form>
                }
            </div>
        </div>
    }
    <div class="d-flex flex-column mx-2">
        <h5>Dane</h5>
        <div class="border border-secondary rounded w-100 flex-grow-0 mb-3  p-3">
            <form class="form d-flex flex-column" asp-action="ClearVisitData" method="post">
                <input asp-for="VisitId" hidden />
                <button type="submit" class="btn btn-primary btn-icon-split    form-control">
                    <span class="icon text-white left" style="text-align:left;float:left">
                        <i class="fa fa-eraser"></i>
                    </span>
                    <span class="text" style="float: left">Wyczyść dane</span>
                </button>
            </form>
        </div>
    </div>
    <div class="d-flex flex-column mx-2">
        <h5>Finalizacja</h5>
        <div class="border border-secondary rounded w-100 flex-grow-0 mb-3  p-3">
            <form class="form d-flex flex-column" asp-action="SetAsCompleted" method="post">
                <input asp-for="VisitId" hidden />
                <input asp-for="Visit.MedicalHistory" hidden />
                <button type="submit" class="btn btn-primary btn-icon-split    form-control">
                    <span class="icon text-white left" style="text-align:left;float:left">
                        <i class="fas fa-flag-checkered"></i>
                    </span>
                    <span class="text" style="float: left">Oznacz wizytę jako zakończoną</span>
                </button>
            </form>
            <form class="form  d-flex flex-column mt-2" asp-action="SetAsCancelledNoPatient" method="post">
                <input asp-for="VisitId" hidden />
                <input asp-for="Visit.MedicalHistory" hidden />
                <button type="submit" class="btn btn-primary btn-icon-split    form-control">
                    <span class="icon text-white left" style="text-align:left;float:left">
                        <i class="fas fa-user-slash"></i>
                    </span>
                    <span class="text" style="float: left">Anulowana (nieobecny pacjent)</span>
                </button>
            </form>
            <form class="form  d-flex mt-2 flex-column" asp-action="SetAsCancelledOther" method="post">
                <input asp-for="VisitId" hidden />
                <input asp-for="Visit.MedicalHistory" hidden />
                <button type="submit" class="btn btn-primary btn-icon-split    form-control">
                    <span class="icon text-white left" style="text-align:left;float:left">
                        <i class="fas fa-comment-slash"></i>
                    </span>
                    <span class="text" style="float: left">Anulowana (inna przyczyna)</span>
                </button>
            </form>
        </div>
    </div>
</div>
